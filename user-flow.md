# 用户交互流程图

## 主要用户路径

### 1. 首次使用流程
```
启动小程序
    ↓
检查登录状态
    ↓
[未登录] → 微信授权登录 → 进入今日打卡页
    ↓
[已登录] → 直接进入今日打卡页
```

### 2. 日常打卡流程
```
进入今日打卡页
    ↓
填写预习提问
    ↓
上传错题讲解视频
    ↓
编写学习日记
    ↓
点击"完成今日打卡"
    ↓
显示成功提示
    ↓
数据保存到云端
```

### 3. 查看历史记录流程
```
点击"历史记录"Tab
    ↓
显示日历视图
    ↓
点击有记录的日期
    ↓
显示该日的打卡详情
    ↓
可播放视频/查看图片
```

## 详细交互说明

### 今日打卡页交互

#### 预习提问模块
```
初始状态：显示一个输入框
    ↓
用户输入内容
    ↓
点击"+ 添加更多提问"
    ↓
新增一个输入框
    ↓
最多支持5个问题
```

#### 视频上传模块
```
点击上传区域
    ↓
调用微信选择视频API
    ↓
[选择成功] → 显示上传进度 → 上传完成显示缩略图
    ↓
[取消选择] → 返回初始状态
    ↓
点击缩略图右上角X → 删除视频
```

#### 日记模块
```
点击文本输入框
    ↓
键盘弹起，输入框自动聚焦
    ↓
点击"📷 添加图片"
    ↓
调用微信选择图片API
    ↓
最多选择9张图片
    ↓
图片以网格形式显示在文本下方
```

#### 提交流程
```
点击"完成今日打卡"
    ↓
验证必填项（至少一个预习问题）
    ↓
[验证失败] → 显示错误提示
    ↓
[验证成功] → 显示loading状态
    ↓
上传数据到服务器
    ↓
[上传成功] → 显示成功提示 → 清空表单
    ↓
[上传失败] → 显示错误提示 → 保留数据
```

### 历史记录页交互

#### 日历交互
```
进入历史记录页
    ↓
加载当月打卡数据
    ↓
高亮显示有记录的日期
    ↓
点击有记录的日期
    ↓
右侧显示该日详情
    ↓
左右滑动切换月份
```

#### 搜索功能
```
点击搜索框
    ↓
输入关键词
    ↓
实时搜索匹配的记录
    ↓
显示搜索结果列表
    ↓
点击结果项 → 跳转到对应日期
```

#### 视频播放
```
点击视频缩略图
    ↓
全屏播放视频
    ↓
支持暂停/播放/进度控制
    ↓
点击返回按钮 → 退出全屏
```

### 用户中心页交互

#### 数据导出
```
点击"📤 导出数据"
    ↓
显示导出选项弹窗
    ↓
选择导出格式（Excel/PDF）
    ↓
选择时间范围
    ↓
点击确认导出
    ↓
生成文件并分享
```

#### 设置功能
```
点击"⚙️ 设置"
    ↓
显示设置页面
    ↓
可设置：
- 每日提醒时间
- 深色模式开关
- 数据同步设置
```

## 错误处理流程

### 网络错误
```
网络请求失败
    ↓
显示网络错误提示
    ↓
提供重试按钮
    ↓
用户点击重试 → 重新发起请求
```

### 上传失败
```
文件上传失败
    ↓
显示上传失败提示
    ↓
保留用户已输入的内容
    ↓
提供重新上传选项
```

### 数据丢失保护
```
用户输入内容时
    ↓
自动保存草稿到本地存储
    ↓
页面刷新/重新进入时
    ↓
检查是否有草稿
    ↓
[有草稿] → 询问是否恢复
    ↓
[无草稿] → 显示空白表单
```

## 状态管理

### 页面状态
- loading: 加载中
- success: 操作成功
- error: 操作失败
- empty: 无数据

### 数据状态
- draft: 草稿状态
- uploading: 上传中
- uploaded: 已上传
- synced: 已同步

### 用户状态
- guest: 未登录
- logged_in: 已登录
- expired: 登录过期

## 性能优化

### 图片处理
```
用户选择图片
    ↓
压缩图片（最大1MB）
    ↓
生成缩略图
    ↓
上传到云存储
    ↓
保存图片URL
```

### 视频处理
```
用户选择视频
    ↓
检查文件大小（最大100MB）
    ↓
生成视频封面
    ↓
上传到云存储
    ↓
保存视频URL和封面URL
```

### 数据缓存
```
首次加载数据
    ↓
缓存到本地存储
    ↓
下次访问时
    ↓
先显示缓存数据
    ↓
后台更新最新数据
    ↓
数据更新后刷新界面